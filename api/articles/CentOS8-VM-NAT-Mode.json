{"title":"How to connect CentOS8 VM to internet via NAT mode","uid":"0723a0f3da0efde08b22864279957623","slug":"CentOS8-VM-NAT-Mode","date":"2022-01-15T05:09:48.000Z","updated":"2022-01-19T13:06:51.451Z","comments":true,"path":"api/articles/CentOS8-VM-NAT-Mode.json","keywords":"webDesign","cover":[],"content":"<h3 id=\"基本原理：通过VMnet8网卡实现主机与虚拟机之间的通信\"><a href=\"#基本原理：通过VMnet8网卡实现主机与虚拟机之间的通信\" class=\"headerlink\" title=\"基本原理：通过VMnet8网卡实现主机与虚拟机之间的通信\"></a>基本原理：通过<code>VMnet8</code>网卡实现主机与虚拟机之间的通信</h3><ul>\n<li>在<code>NAT模式</code>中，主机网卡直接与虚拟NAT设备相连，然后虚拟NAT设备与虚拟DHCP服务器一起连接在虚拟交换机<code>VMnet8</code>上，这样就实现了虚拟机联网</li>\n</ul>\n<h3 id=\"启用VMware网址转换服务\"><a href=\"#启用VMware网址转换服务\" class=\"headerlink\" title=\"启用VMware网址转换服务\"></a>启用<code>VMware</code>网址转换服务</h3><ul>\n<li>win10<code>WIN+R</code>打开搜索框，输入<code>services.msc</code>打开服务</li>\n<li>开启<code>VMware DHCP service</code>&amp;<code>VMware NAT service</code>两项服务</li>\n</ul>\n<h3 id=\"启用ICMPv4-in入站规则\"><a href=\"#启用ICMPv4-in入站规则\" class=\"headerlink\" title=\"启用ICMPv4-in入站规则\"></a>启用<code>ICMPv4-in</code>入站规则</h3><ul>\n<li>win10<code>WIN+I</code>打开设置，搜索防火墙并进入，选择<code>高级设置</code></li>\n<li>开启3个<code>ICMPv4-In</code>入站规则</li>\n</ul>\n<h3 id=\"配置虚拟机NAT模式\"><a href=\"#配置虚拟机NAT模式\" class=\"headerlink\" title=\"配置虚拟机NAT模式\"></a>配置虚拟机<code>NAT模式</code></h3><ul>\n<li>设置虚拟机网络连接模式<ul>\n<li>选中虚拟机，<code>编辑虚拟机设置</code> &gt; <code>硬件 | 网络适配器</code> &gt; <code>网络连接 | NAT模式</code></li>\n</ul>\n</li>\n<li>配置虚拟机网关<ul>\n<li><code>VMware</code>菜单栏 &gt; <code>编辑</code> &gt; <code>虚拟网络编辑器</code> &gt; 选中<code>VMnet8 NAT模式</code></li>\n<li>打开<code>NAT设置</code>，查看子网<code>网关IP: 192.168.56.2</code>，保留默认配置</li>\n<li>打开<code>DNS设置</code>，设置<code>首选DNS服务器</code>为主机<code>默认网关：192.168.2.1</code>（查看方式：Win10命令行窗口输入<code>ipconfig</code>）<br><img src=\"https://cdn.jsdelivr.net/gh/gavinst/PicGoCDN/img/img6qCuabZ3ONKtt0K8.png\"></li>\n<li>在<code>虚拟网络编辑器</code>界面，打开<code>DHCP设置</code>，查看<code>起始&amp;结束IP地址</code>，之后设置虚拟机<code>IPADDR</code>时，将在此之间<br><img src=\"https://cdn.jsdelivr.net/gh/gavinst/PicGoCDN/img/imgg9scAimnOs6CoClG.png\"></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"配置主机VMnet8网络适配器\"><a href=\"#配置主机VMnet8网络适配器\" class=\"headerlink\" title=\"配置主机VMnet8网络适配器\"></a>配置主机<code>VMnet8</code>网络适配器</h3><ul>\n<li>Win10命令行窗口输入<code>ncpa.cpl</code>，打开适配器选项</li>\n<li>右键<code>VMnet8 | 属性</code> &gt; 双击<code>TCP/IPv4</code>选项</li>\n<li>设置<code>IP地址</code>和虚拟机在同一网段<code>192.168.56.x</code></li>\n<li><code>首选DNS服务器</code>设置为主机<code>默认网关：192.168.2.1</code></li>\n</ul>\n<h3 id=\"配置虚拟机网卡信息\"><a href=\"#配置虚拟机网卡信息\" class=\"headerlink\" title=\"配置虚拟机网卡信息\"></a>配置虚拟机网卡信息</h3><ul>\n<li>查看虚拟机网络配置，虚拟机终端输入<code>ifconfig</code>，获取相应<code>device name</code>为<code>ens160</code></li>\n<li>切换<code>root</code>用户，编辑配置文件<ul>\n<li><code>vi /etc/sysconfig/network-scripts/ifcfg-ens160</code></li>\n</ul>\n</li>\n<li>填入虚拟机<code>NAT模式</code>的默认配置，修改后保存<ul>\n<li><code>IPADDR</code>设为之前查看的<code>DHCP</code>网段之间</li>\n<li><code>NETMASK</code>默认<code>255.255.255.0</code></li>\n<li><code>GATEWAY</code>子网网关<code>192.168.56.2</code><br><img src=\"https://cdn.jsdelivr.net/gh/gavinst/PicGoCDN/img/imgluBXopOV5sa5qujp.png\"></li>\n</ul>\n</li>\n<li>修改DNS客户机的配置文件<ul>\n<li><code>vi /etc/resolv.conf</code>，修改为<code>nameserver 192.168.56.2</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"重启虚拟机网络服务\"><a href=\"#重启虚拟机网络服务\" class=\"headerlink\" title=\"重启虚拟机网络服务\"></a>重启虚拟机网络服务</h3><ul>\n<li>重启网络服务或重启虚拟机  <pre class=\"line-numbers language-none\"><code class=\"language-none\">nmcli c reload  &#x2F;&#x2F;vm下安装CentOS用此命令重启\n\nservice NetworkManager stop  &#x2F;&#x2F;临时关闭，避免与network重启冲突\nservice network restart\nservice NetworkManager restart\n\n&#x2F;&#x2F;其他命令\nservice NetworkManager status\nchkconfig NetworkManager off  &#x2F;&#x2F;禁止开机启动\nchkconfig NetworkManager on  &#x2F;&#x2F;开机启动</code></pre></li>\n<li>测试网络连接<ul>\n<li><code>ping baidu.com</code></li>\n</ul>\n</li>\n<li><code>Network</code>和<code>NetworkManager</code>区别<ul>\n<li><code>Network</code>：对网卡的配置，网络接口修改后，必须重启网络服务来刷新配置，或重启系统来激活</li>\n<li><code>NetworkManager</code>：检测、自动连接网络的程序</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"配置虚拟机网络代理，设置代理IP和端口Port\"><a href=\"#配置虚拟机网络代理，设置代理IP和端口Port\" class=\"headerlink\" title=\"配置虚拟机网络代理，设置代理IP和端口Port\"></a>配置虚拟机网络代理，设置代理IP和端口Port</h3><ul>\n<li><code>firefox</code>网页代理，首选项 &gt; 网络设置 &gt; 代理设置<br><img src=\"https://cdn.jsdelivr.net/gh/gavinst/PicGoCDN/img/imgz9srti7nO8pCoWnb.png\"></li>\n<li><code>yum</code>代理，<code>echo &#39;proxy=IP:Port&#39; &gt;&gt; /etc/yum.conf</code></li>\n<li><code>wget</code>代理，<code>echo -e &#39;http_proxy = IP:Port\\nftp_proxy = IP:Port\\nuse_proxy = on&#39; &gt;&gt; /etc/wgetrc</code> </li>\n<li>系统环境代理<ul>\n<li>编辑文件<code>/etc/profile</code>，若只为当前账户代理，则编辑<code>~/.bashrc</code>，添加以下3项  <pre class=\"line-numbers language-none\"><code class=\"language-none\"># add proxy\nexport http_proxy&#x3D;&quot;IP:Port&quot;\nexport https_proxy&#x3D;&quot;IP:Port&quot;\nexport ftp_proxy&#x3D;$http_proxy</code></pre></li>\n<li>刷新环境变量，<code>source /etc/profile</code>或<code>source ~/.bashrc</code></li>\n</ul>\n</li>\n</ul>\n","text":"基本原理：通过VMnet8网卡实现主机与虚拟机之间的通信 在NAT模式中，主机网卡直接与虚拟NAT设备相连，然后虚拟NAT设备与虚拟DHCP服务器一起连接在虚拟交换机VMnet8上，这样就实现了虚拟机联网 启用VMware网址转换服务 win10WIN+R打开搜索框，输入serv...","link":"","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"VMware","slug":"VMware","count":1,"path":"api/categories/VMware.json"}],"tags":[{"name":"vmware","slug":"vmware","count":1,"path":"api/tags/vmware.json"},{"name":"NAT","slug":"NAT","count":1,"path":"api/tags/NAT.json"},{"name":"centOS8","slug":"centOS8","count":1,"path":"api/tags/centOS8.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%EF%BC%9A%E9%80%9A%E8%BF%87VMnet8%E7%BD%91%E5%8D%A1%E5%AE%9E%E7%8E%B0%E4%B8%BB%E6%9C%BA%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1\"><span class=\"toc-text\">基本原理：通过VMnet8网卡实现主机与虚拟机之间的通信</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%90%AF%E7%94%A8VMware%E7%BD%91%E5%9D%80%E8%BD%AC%E6%8D%A2%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">启用VMware网址转换服务</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%90%AF%E7%94%A8ICMPv4-in%E5%85%A5%E7%AB%99%E8%A7%84%E5%88%99\"><span class=\"toc-text\">启用ICMPv4-in入站规则</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BANAT%E6%A8%A1%E5%BC%8F\"><span class=\"toc-text\">配置虚拟机NAT模式</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BAVMnet8%E7%BD%91%E7%BB%9C%E9%80%82%E9%85%8D%E5%99%A8\"><span class=\"toc-text\">配置主机VMnet8网络适配器</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E5%8D%A1%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">配置虚拟机网卡信息</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%87%8D%E5%90%AF%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">重启虚拟机网络服务</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86%EF%BC%8C%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86IP%E5%92%8C%E7%AB%AF%E5%8F%A3Port\"><span class=\"toc-text\">配置虚拟机网络代理，设置代理IP和端口Port</span></a></li></ol>","author":{"name":"Gavinst","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"🔸🔹🔶❌🔷🔸🔹<br>寄蜉蝣于天地 渺沧海之一粟","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Hello World","uid":"b9663f58f18133b35bfe243f3e916a80","slug":"hello-world","date":"2022-01-16T15:57:03.877Z","updated":"2022-01-16T15:57:03.877Z","comments":true,"path":"api/articles/hello-world.json","keywords":"webDesign","cover":null,"text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the ...","link":"","photos":[],"count_time":{"symbolsCount":440,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"Gavinst","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"🔸🔹🔶❌🔷🔸🔹<br>寄蜉蝣于天地 渺沧海之一粟","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{}}